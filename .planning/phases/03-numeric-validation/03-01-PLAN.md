---
phase: 03-numeric-validation
plan: 03-01
type: execute
domain: agents
---

<objective>
Set up Google ADK client infrastructure and create the Planner agent that identifies Financial Statement Line Items (FSLIs) from extracted document text.

Purpose: Establish agent foundation and first stage of numeric validation pipeline.
Output: Working Planner agent that outputs structured FSLI list for downstream validation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-numeric-validation/DISCOVERY.md
@.planning/phases/01-foundation/01-03-SUMMARY.md
@backend/app/models/finding.py
@backend/app/models/job.py
@backend/app/services/storage.py

**Tech stack available:**
- google-adk, google-genai already in requirements.txt
- FastAPI + async SQLAlchemy backend
- Job, Document, Finding models exist

**Pattern from DISCOVERY.md:**
- LlmAgent with instruction, output_key for state sharing
- Use gemini-2.0-flash model
- FSLI = Financial Statement Line Item

**Constraining decisions:**
- code_executor can only be used by itself in an agent (validator will be separate)
- State passed between agents via output_key â†’ session.state
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ADK client and agent base service</name>
  <files>backend/app/services/agents/__init__.py, backend/app/services/agents/client.py, backend/app/config.py</files>
  <action>
1. Create backend/app/services/agents/ directory with __init__.py
2. Create client.py with ADK client initialization:
   - Import from google.adk.agents (LlmAgent, SequentialAgent)
   - Import from google.adk.runners (InMemoryRunner)
   - Import from google.genai (Client)
   - Create async function get_adk_runner() that returns configured runner
   - Use GOOGLE_API_KEY from environment (add to config.py if missing)
3. Export get_adk_runner from __init__.py
4. Update config.py to include GOOGLE_API_KEY: str | None = None

Avoid: Don't use VertexAI client - use google.genai Client for Gemini API directly. Don't create complex abstractions yet.
  </action>
  <verify>python -c "from app.services.agents.client import get_adk_runner" runs without import errors</verify>
  <done>ADK client module exists, can be imported, config has GOOGLE_API_KEY</done>
</task>

<task type="auto">
  <name>Task 2: Create Planner agent for FSLI identification</name>
  <files>backend/app/services/agents/planner.py</files>
  <action>
1. Create planner.py with PlannerAgent class:
   - Define PLANNER_INSTRUCTION constant with detailed prompt:
     * You are a financial document analyst
     * Given extracted document text, identify all Financial Statement Line Items (FSLIs)
     * An FSLI is a named row/category with associated numeric values (e.g., "Revenue: $1,000,000")
     * Output JSON array with structure: [{name, values: [{label, amount, unit}], source_ref}]
     * Include table references and row numbers in source_ref
   - Create function create_planner_agent() -> LlmAgent:
     * name="PlannerAgent"
     * model="gemini-3-pro-preview"
     * instruction=PLANNER_INSTRUCTION
     * output_key="fslis"
2. Export create_planner_agent from agents/__init__.py

Avoid: Don't add code_executor to this agent - planner only does text analysis. Don't make the instruction too complex - focus on structured extraction.
  </action>
  <verify>python -c "from app.services.agents.planner import create_planner_agent; a = create_planner_agent(); print(a.name)" prints "PlannerAgent"</verify>
  <done>Planner agent can be instantiated, has correct instruction for FSLI extraction</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] backend/app/services/agents/ directory exists with __init__.py, client.py, planner.py
- [ ] All imports work without errors
- [ ] GOOGLE_API_KEY added to config.py
- [ ] Planner agent can be created and has output_key="fslis"
</verification>

<success_criteria>
- All tasks completed
- Agent infrastructure ready for Phase 03-02
- Planner agent defined with proper FSLI extraction prompt
- No import errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-numeric-validation/03-01-SUMMARY.md`:

# Phase 03 Plan 01: ADK Setup + Planner Agent Summary

**[Substantive one-liner about what was built]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `backend/app/services/agents/__init__.py` - Description
- `backend/app/services/agents/client.py` - Description
- `backend/app/services/agents/planner.py` - Description
- `backend/app/config.py` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 03-02-PLAN.md (Validator agent with code_executor)
</output>
