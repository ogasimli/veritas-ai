---
phase: 03-numeric-validation
plan: 03-01
type: execute
domain: agents
---

<objective>
Set up Google ADK client infrastructure and create the Extractor agent that identifies Financial Statement Line Item (FSLI) names from extracted document text.

Purpose: Establish agent foundation and first stage of numeric validation pipeline.
Output: Working Extractor agent that outputs a list of FSLI names for downstream parallel verification.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-numeric-validation/DISCOVERY.md
@.planning/phases/01-foundation/01-03-SUMMARY.md
@backend/app/models/finding.py
@backend/app/models/job.py
@backend/app/services/storage.py

**Tech stack available:**
- google-adk, google-genai already in requirements.txt
- FastAPI + async SQLAlchemy backend
- Job, Document, Finding models exist

**Pattern from DISCOVERY.md:**
- LlmAgent with instruction, output_key for state sharing
- Use gemini-3-pro-preview model
- FSLI = Financial Statement Line Item
- Extractor outputs only FSLI names (simplified for accuracy)

**Constraining decisions:**
- code_executor can only be used by itself in an agent (Verifier will use it)
- State passed between agents via output_key â†’ session.state
- Extractor only outputs FSLI names, not values/amounts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ADK client and agent base service</name>
  <files>backend/app/services/agents/__init__.py, backend/app/services/agents/client.py, backend/app/config.py</files>
  <action>
1. Create backend/app/services/agents/ directory with __init__.py
2. Create client.py with ADK client initialization:
   - Import from google.adk.agents (LlmAgent, SequentialAgent)
   - Import from google.adk.runners (InMemoryRunner)
   - Import from google.genai (Client)
   - Create async function get_adk_runner() that returns configured runner
   - Use GOOGLE_API_KEY from environment (add to config.py if missing)
3. Export get_adk_runner from __init__.py
4. Update config.py to include GOOGLE_API_KEY: str | None = None

Avoid: Don't use VertexAI client - use google.genai Client for Gemini API directly. Don't create complex abstractions yet.
  </action>
  <verify>python -c "from app.services.agents.client import get_adk_runner" runs without import errors</verify>
  <done>ADK client module exists, can be imported, config has GOOGLE_API_KEY</done>
</task>

<task type="auto">
  <name>Task 2: Create Extractor agent for FSLI name identification</name>
  <files>backend/agents/numeric_validation/sub_agents/extractor/agent.py, backend/agents/numeric_validation/sub_agents/extractor/prompt.py, backend/agents/numeric_validation/sub_agents/extractor/schema.py, backend/agents/numeric_validation/sub_agents/extractor/__init__.py</files>
  <action>
1. Create directory structure: backend/agents/numeric_validation/sub_agents/extractor/
2. Create schema.py with ExtractorAgentOutput:
   ```python
   from typing import List
   from pydantic import BaseModel

   class ExtractorAgentOutput(BaseModel):
       fsli_names: List[str]  # ["Revenue", "Cost of Sales", "Net Income", ...]
   ```
3. Create prompt.py with INSTRUCTION constant:
   - You are a financial document analyst specialized in identifying FSLIs
   - Given extracted document text, identify all Financial Statement Line Items
   - An FSLI is a named row/category in financial tables (e.g., "Revenue", "Total Assets")
   - Output ONLY the names of FSLIs found, not their values
   - Include items from all tables: income statement, balance sheet, cash flow, notes
4. Create agent.py with extractor_agent:
   ```python
   from google.adk.agents import LlmAgent
   from google.adk.planners import BuiltInPlanner
   from google.genai import types
   from . import prompt
   from .schema import ExtractorAgentOutput

   extractor_agent = LlmAgent(
       name="ExtractorAgent",
       model="gemini-3-pro-preview",
       instruction=prompt.INSTRUCTION,
       output_key="extractor_output",
       output_schema=ExtractorAgentOutput,
       planner=BuiltInPlanner(
           thinking_config=types.ThinkingConfig(thinking_level="high")
       ),
   )
   ```
5. Create __init__.py to export extractor_agent

Avoid: Don't add code_executor to this agent - Extractor only does text analysis. Don't extract values/amounts - only FSLI names.
  </action>
  <verify>python -c "from agents.numeric_validation.sub_agents.extractor import extractor_agent; print(extractor_agent.name)" prints "ExtractorAgent"</verify>
  <done>Extractor agent can be instantiated, outputs simplified FSLI names list</done>
</task>

<task type="auto">
  <name>Task 3: Create root agent and package structure</name>
  <files>backend/agents/numeric_validation/agent.py, backend/agents/numeric_validation/__init__.py, backend/agents/numeric_validation/sub_agents/__init__.py</files>
  <action>
1. Create backend/agents/numeric_validation/__init__.py:
   ```python
   """Numeric validation agent package."""
   from . import agent
   ```
2. Create backend/agents/numeric_validation/sub_agents/__init__.py:
   ```python
   """Sub-agents for numeric validation."""
   from .extractor import extractor_agent
   ```
3. Create backend/agents/numeric_validation/agent.py:
   ```python
   """Root agent definition."""
   from google.adk.agents import SequentialAgent
   from .sub_agents import extractor_agent

   root_agent = SequentialAgent(
       name='numeric_validation',
       description='Pipeline for financial statement numeric validation',
       sub_agents=[extractor_agent],  # fan_out_verifier, reviewer to be added
   )
   ```

Avoid: Don't add validators/managers yet - they come in later phases.
  </action>
  <verify>python -c "from agents.numeric_validation.agent import root_agent; print(root_agent.name)" prints "numeric_validation"</verify>
  <done>Root agent created with Extractor as first sub-agent</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] backend/app/services/agents/ directory exists with __init__.py, client.py
- [ ] backend/agents/numeric_validation/sub_agents/extractor/ exists with agent.py, prompt.py, schema.py
- [ ] All imports work without errors
- [ ] GOOGLE_API_KEY added to config.py
- [ ] Extractor agent can be created and has output_key="extractor_output"
- [ ] ExtractorAgentOutput schema has only fsli_names: List[str]
- [ ] Root agent exists with Extractor as sub-agent
</verification>

<success_criteria>
- All tasks completed
- Agent infrastructure ready for Phase 03-02
- Extractor agent defined with simplified FSLI name extraction prompt
- No import errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-numeric-validation/03-01-SUMMARY.md`:

# Phase 03 Plan 01: ADK Setup + Extractor Agent Summary

**[Substantive one-liner about what was built]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `backend/app/services/agents/__init__.py` - Description
- `backend/app/services/agents/client.py` - Description
- `backend/agents/numeric_validation/sub_agents/extractor/agent.py` - Description
- `backend/agents/numeric_validation/sub_agents/extractor/prompt.py` - Description
- `backend/agents/numeric_validation/sub_agents/extractor/schema.py` - Description
- `backend/app/config.py` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 03-02-PLAN.md (FanOutVerifierAgent with CustomAgent pattern for parallel FSLI verification)
</output>
