# Phase 4.1: Logic Reviewer - Context

**Gathered:** 2026-01-19
**Status:** Ready for planning

<vision>
## How This Should Work

Add a Reviewer stage to the logic_consistency agent to refine findings through false-positive filtering and severity assignment.

Currently, logic_consistency is a single LlmAgent that detects semantic contradictions in financial statements. While effective at finding potential issues, it can produce false positives when it encounters:

1. **Industry-specific patterns** - Normal industry practices that seem illogical without domain knowledge (e.g., SaaS deferred revenue > current revenue)
2. **Timing differences** - Seasonal variation or business cycles that look like contradictions when comparing periods
3. **Lack of context** - Statements that seem illogical in isolation but make sense with broader company context

The Reviewer stage receives findings from the detector, filters out false positives by re-examining them with more context, and assigns business-impact-based severity levels to help auditors prioritize.

**Architecture:** Convert from single LlmAgent to 2-stage SequentialAgent:
- **Stage 1 (Detector):** Current logic_consistency agent - identifies potential semantic contradictions
- **Stage 2 (Reviewer):** New agent - filters false positives and assigns severity

</vision>

<essential>
## What Must Be Nailed

- **Balanced filtering + prioritization** - Reduce false positives without being overly aggressive, AND help auditors focus on what matters most through clear severity levels (High/Medium/Low based on business impact)

- **Business-impact severity** - Severity assignment must reflect real-world consequences:
  - **High:** Material impact on financial position (e.g., revenue recognition contradicts guidance, going concern issues)
  - **Medium:** Operational concerns or compliance risks
  - **Low:** Minor oddities or disclosure quality issues

</essential>

<boundaries>
## What's Out of Scope

- **No new logic detection** - Reviewer only reviews findings from the detector agent. It doesn't look for new inconsistencies.

- **No business advice** - Reviewer doesn't suggest "fix this by doing X" - only reports what's wrong, not how to fix it.

- **No external research** - Reviewer works with document content only. No searching for industry benchmarks or external validation data.

**In summary:** Reviewer strictly refines existing findings - no new detection, no advice, no external research.

</boundaries>

<specifics>
## Specific Ideas

- Refactor logic_consistency from single LlmAgent to SequentialAgent with 2 stages:
  1. **Detector** (existing logic_consistency logic)
  2. **Reviewer** (new filtering + severity stage)

- Reviewer receives list of potential logic inconsistencies from Detector

- For each finding, Reviewer:
  1. **Re-examines with context** - Looks at broader document context to determine if it's a real issue or false positive
  2. **Filters false positives** - Removes findings that are actually valid industry patterns, timing differences, or context-dependent
  3. **Assigns severity** - For confirmed findings, assigns High/Medium/Low based on business impact
  4. **Outputs refined findings** - Smaller, higher-quality list with severity levels

- Pattern similar to numeric_validation but simpler: Detector → Reviewer (2-stage) vs numeric's 3-stage pipeline

</specifics>

<notes>
## Additional Context

This enhancement brings logic_consistency closer to numeric_validation's maturity without full 3-stage complexity.

**Current state:**
- logic_consistency: Single LlmAgent (finds issues, outputs raw findings)

**After Phase 4.1:**
- logic_consistency: SequentialAgent (Detector → Reviewer)
- Detector: Finds potential semantic contradictions (current behavior)
- Reviewer: Filters false positives + assigns business-impact severity

**Comparison to other Reviewers:**
- **numeric Reviewer:** Filter + re-verify with code + deduplicate + severity + summarize (comprehensive)
- **disclosure Reviewer (Phase 5.1):** Filter false positives only (focused on semantic matching)
- **logic Reviewer (Phase 4.1):** Filter false positives + severity assignment (middle ground)

User emphasized balanced approach - not too aggressive on filtering, but clear prioritization through severity to help auditors focus.

</notes>

---

*Phase: 4.1-logic-reviewer*
*Context gathered: 2026-01-19*
