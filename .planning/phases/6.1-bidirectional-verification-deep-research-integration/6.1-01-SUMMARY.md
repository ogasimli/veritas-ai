---
phase: 6.1-bidirectional-verification-deep-research-integration
plan: 01
subsystem: agents
tags: [deep-research, gemini, adk, external-verification, bidirectional]

# Dependency graph
requires:
  - phase: 6-external-signal
    provides: External signal agent pattern with google_search
provides:
  - Deep Research async client with polling and timeout
  - InternetToReport sub-agent (enhanced Phase 6 with Deep Research)
  - ReportToInternet sub-agent (new bidirectional verification)
affects: [6.1-02-integration]

# Tech tracking
tech-stack:
  added: [tenacity]
  patterns: [deep-research-wrapper, bidirectional-verification, async-polling]

key-files:
  created:
    - backend/agents/orchestrator/sub_agents/external_signal_v2/deep_research_client.py
    - backend/agents/orchestrator/sub_agents/external_signal_v2/sub_agents/internet_to_report/agent.py
    - backend/agents/orchestrator/sub_agents/external_signal_v2/sub_agents/report_to_internet/agent.py
  modified: []

key-decisions:
  - "20-minute timeout for Deep Research (vs 60-min API max) for faster failure feedback"
  - "gemini-3-flash-preview for coordination, Deep Research for research - cost optimization"
  - "Two-stage workflow for report→internet: extract claims then verify - clearer separation"

patterns-established:
  - "Deep Research wrapper pattern: LlmAgent tool invokes Interactions API with async polling"
  - "Bidirectional verification: internet→report (signals) + report→internet (claim verification)"
  - "Claim extraction categories: dates, locations, partnerships, regulatory filings, awards, acquisitions, management"

issues-created: []

# Metrics
duration: 2min
completed: 2026-01-21
---

# Phase 6.1 Plan 1: Deep Research Infrastructure Summary

**Deep Research async client and bidirectional sub-agents created with gemini-3-flash-preview coordination**

## Performance

- **Duration:** 2 min
- **Started:** 2026-01-21T18:32:40Z
- **Completed:** 2026-01-21T18:35:32Z
- **Tasks:** 3/3
- **Files modified:** 11

## Accomplishments

- Created DeepResearchClient with async polling, 20-minute timeout protection, and tenacity retry logic
- Created InternetToReport sub-agent enhancing Phase 6 pattern with Deep Research for comprehensive signal detection
- Created ReportToInternet sub-agent implementing new bidirectional pattern for claim extraction and verification
- Both sub-agents use gemini-3-flash-preview for lightweight coordination and Deep Research for multi-step research

## Task Commits

Each task was committed atomically:

1. **Task 1: Create Deep Research async client wrapper** - `c830ea1` (feat)
2. **Task 2: Create internet→report sub-agent** - `6cf1369` (feat)
3. **Task 3: Create report→internet sub-agent** - `d6c46e3` (feat)

**Plan metadata:** (to be committed)

## Files Created/Modified

- `backend/agents/orchestrator/sub_agents/external_signal_v2/deep_research_client.py` - Async wrapper for Interactions API with polling, timeout, retry
- `backend/agents/orchestrator/sub_agents/external_signal_v2/sub_agents/__init__.py` - Sub-agents module exports
- `backend/agents/orchestrator/sub_agents/external_signal_v2/sub_agents/internet_to_report/__init__.py` - InternetToReport module
- `backend/agents/orchestrator/sub_agents/external_signal_v2/sub_agents/internet_to_report/agent.py` - LlmAgent with Deep Research tool for signal detection
- `backend/agents/orchestrator/sub_agents/external_signal_v2/sub_agents/internet_to_report/prompt.py` - Enhanced Phase 6 prompt for Deep Research
- `backend/agents/orchestrator/sub_agents/external_signal_v2/sub_agents/internet_to_report/schema.py` - ExternalFinding and InternetToReportOutput schemas
- `backend/agents/orchestrator/sub_agents/external_signal_v2/sub_agents/report_to_internet/__init__.py` - ReportToInternet module
- `backend/agents/orchestrator/sub_agents/external_signal_v2/sub_agents/report_to_internet/agent.py` - LlmAgent with Deep Research verification tool
- `backend/agents/orchestrator/sub_agents/external_signal_v2/sub_agents/report_to_internet/prompt.py` - Two-stage claim extraction and verification prompt
- `backend/agents/orchestrator/sub_agents/external_signal_v2/sub_agents/report_to_internet/schema.py` - ClaimVerification and ReportToInternetOutput schemas

## Decisions Made

**1. 20-minute default timeout (vs 60-minute API maximum)**
- Rationale: Faster failure feedback for users. API allows up to 60 minutes, but 20 minutes provides reasonable completion window while preventing long waits on failures. Applications can override if needed.

**2. gemini-3-flash-preview for coordination, Deep Research for research**
- Rationale: Cost optimization. Flash model handles lightweight coordination (claim extraction, result formatting), while Deep Research handles expensive multi-step research. Separation of concerns reduces total cost.

**3. Two-stage workflow for report→internet: extract claims, then verify**
- Rationale: Clearer separation of responsibilities. Extraction is deterministic pattern matching, verification is open-ended research. Splitting stages makes each step more focused and debuggable.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## Next Phase Readiness

Ready for Plan 6.1-02:
- Deep Research infrastructure complete and tested (syntax validation)
- Both sub-agents implement proper schemas and tool patterns
- Ready for ParallelAgent orchestration and root agent integration

**Next step:** Create ParallelAgent orchestrator, update root agent, modify processor for new finding types.

---
*Phase: 6.1-bidirectional-verification-deep-research-integration*
*Completed: 2026-01-21*
