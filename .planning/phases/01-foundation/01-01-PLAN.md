---
phase: 01-foundation
plan: 01
type: execute
---

<objective>
Set up FastAPI backend with async SQLAlchemy foundation.

Purpose: Establish the backend structure and database connection that all agents and APIs will use.
Output: Working FastAPI app with health endpoint and async database engine configured.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Tech stack (from PROJECT.md):**
- Backend: FastAPI + async SQLAlchemy + asyncpg
- Database: PostgreSQL (Cloud SQL in prod, local for dev)

**No prior summaries** (first plan)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FastAPI project structure</name>
  <files>backend/app/__init__.py, backend/app/main.py, backend/app/config.py, backend/requirements.txt, backend/.env.example</files>
  <action>
Create backend directory structure:
- backend/app/__init__.py (empty)
- backend/app/main.py: FastAPI app with CORS middleware (allow all origins for dev), lifespan handler for startup/shutdown
- backend/app/config.py: Pydantic Settings class loading from env vars (DATABASE_URL, GCS_BUCKET, GEMINI_API_KEY, DEBUG)
- backend/requirements.txt: fastapi, uvicorn[standard], sqlalchemy[asyncio], asyncpg, pydantic-settings, google-cloud-storage, python-docx, google-adk, google-genai, alembic
- backend/.env.example: Template with all required vars

Use pydantic-settings (not pydantic BaseSettings directly - deprecated in v2). Use functools.lru_cache for settings singleton.
  </action>
  <verify>cd backend && python -c "from app.config import get_settings; print(get_settings())"</verify>
  <done>Config loads without errors, all env vars defined in .env.example</done>
</task>

<task type="auto">
  <name>Task 2: Set up async SQLAlchemy engine</name>
  <files>backend/app/db.py, backend/app/models/__init__.py, backend/app/models/base.py</files>
  <action>
Create database foundation:
- backend/app/db.py: create_async_engine with DATABASE_URL, async sessionmaker, get_db dependency (async generator yielding session)
- backend/app/models/__init__.py: empty for now
- backend/app/models/base.py: DeclarativeBase class for all models

Use SQLAlchemy 2.0 style with mapped_column, Mapped type hints. Engine should use pool_pre_ping=True for connection health. Session should use expire_on_commit=False for async compatibility.
  </action>
  <verify>cd backend && python -c "from app.db import engine, async_session; print('DB configured:', engine.url)"</verify>
  <done>Engine and session factory created, get_db dependency ready for use</done>
</task>

<task type="auto">
  <name>Task 3: Add health check endpoint</name>
  <files>backend/app/api/__init__.py, backend/app/api/routes/__init__.py, backend/app/api/routes/health.py, backend/app/main.py</files>
  <action>
Create API structure and health endpoint:
- backend/app/api/__init__.py: empty
- backend/app/api/routes/__init__.py: empty
- backend/app/api/routes/health.py: GET /health endpoint returning {"status": "ok", "database": "connected|disconnected"}
  - Health endpoint should test DB connection with a simple SELECT 1 query
  - Return 200 even if DB disconnected (but status field shows it)
- Update main.py to include health router with prefix /api

Test with: uvicorn app.main:app --reload (from backend dir)
  </action>
  <verify>cd backend && timeout 5 bash -c 'uvicorn app.main:app --port 8001 &amp; sleep 2 &amp;&amp; curl -s http://localhost:8001/api/health &amp;&amp; kill %1' || echo "Server test complete"</verify>
  <done>GET /api/health returns 200 with status JSON, server starts without errors</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd backend && python -c "from app.main import app; print(app.title)"` succeeds
- [ ] All imports resolve without errors
- [ ] .env.example contains all required variables
- [ ] Health endpoint structure is correct
</verification>

<success_criteria>
- All tasks completed
- FastAPI app starts with uvicorn
- Config loads from environment
- Database engine configured (connection tested in health endpoint)
- Health endpoint accessible at /api/health
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
