---
phase: 08-backend-websocket-support
plan: 8-01-FIX2
type: fix
---

<objective>
Fix 1 UAT blocker issue from Phase 8 Plan 1 FIX.

Source: 8-01-ISSUES.md
Priority: 1 blocker (API endpoint URL mismatch preventing file upload)

Purpose: Correct the API endpoint URL in frontend to match backend routing structure, enabling successful file uploads and complete end-to-end WebSocket verification.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/08-backend-websocket-support/8-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/08-backend-websocket-support/8-01-PLAN.md

**Previous fix for reference:**
@.planning/phases/08-backend-websocket-support/8-01-FIX.md

**Key insight from UAT:**
The 8-01-FIX implementation assumed the upload endpoint was at `/documents/upload`, but the actual backend has it registered at `/api/v1/documents/upload` due to router prefix in main.py. This is a simple one-line URL fix.

**Backend routing structure:**
- `backend/app/main.py:43` - Documents router registered with prefix: `app.include_router(documents_router, prefix="/api/v1/documents", tags=["documents"])`
- `backend/app/api/routes/documents.py:57` - Upload endpoint: `@router.post("/upload")`
- Combined URL: `POST /api/v1/documents/upload`

**Frontend needs to call:**
`http://localhost:8000/api/v1/documents/upload` (not `/documents/upload`)
</context>

<tasks>

<task type="auto">
  <name>Fix UAT-002: Correct API endpoint URL in frontend/lib/api.ts</name>
  <files>frontend/lib/api.ts</files>
  <action>
  Update the uploadFile() function to use the correct API endpoint URL:

  Change line 32 from:
  ```typescript
  const response = await fetch(`${API_URL}/documents/upload`, {
  ```

  To:
  ```typescript
  const response = await fetch(`${API_URL}/api/v1/documents/upload`, {
  ```

  This matches the backend routing structure where:
  - Router prefix: `/api/v1/documents` (from main.py:43)
  - Endpoint path: `/upload` (from documents.py:57)
  - Full path: `/api/v1/documents/upload`

  No other changes needed - error handling, FormData, response parsing all correct from 8-01-FIX.
  </action>
  <verify>
  1. TypeScript compiles: cd frontend && npm run build
  2. Grep confirms correct URL: grep -n "api/v1/documents/upload" frontend/lib/api.ts
  3. Manual test: Start services, upload file, verify 200 response (not 404)
  </verify>
  <done>
  - Frontend calls correct endpoint: /api/v1/documents/upload
  - No more 404 errors on file upload
  - Backend receives POST request successfully
  - Job ID returned from backend
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TypeScript compiles without errors
- [ ] API endpoint URL matches backend routing
- [ ] File upload succeeds (no 404 errors)
- [ ] Backend processes upload and returns job ID
- [ ] Ready for complete end-to-end WebSocket verification
</verification>

<success_criteria>

- UAT-002 from 8-01-ISSUES.md resolved
- Frontend calls correct API endpoint
- File upload works end-to-end
- Backend processing triggered successfully
- WebSocket integration testable end-to-end
- Ready for final re-verification with /gsd:verify-work 8
</success_criteria>

<output>
After completion, create `.planning/phases/08-backend-websocket-support/8-01-FIX2-SUMMARY.md` and update 8-01-ISSUES.md to move UAT-002 to Resolved Issues section.
</output>
