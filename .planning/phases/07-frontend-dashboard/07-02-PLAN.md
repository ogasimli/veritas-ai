---
phase: 07-frontend-dashboard
plan: 02
type: execute
---

<objective>
Implement file upload functionality with drag & drop, strict validation, and visual feedback.

Purpose: Enable users to upload .docx financial documents with client-side validation, preparing documents for analysis.
Output: Working file upload UI with three slots (Current Year, Prior Year, Internal Memos), validation, and upload to FastAPI backend.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-frontend-dashboard/07-CONTEXT.md
@.planning/phases/07-frontend-dashboard/07-RESEARCH.md
@.planning/phases/07-frontend-dashboard/07-01-SUMMARY.md
@frontend/lib/api.ts

**From CONTEXT.md:**
- Three upload zones: Current Year (required), Prior Year (optional), Internal Memos (optional)
- Strict validation: only .docx files accepted
- Show error immediately if wrong file type dropped
- Visual feedback: green checkmark when valid file uploaded
- "Start Review" button appears when at least one file uploaded

**From RESEARCH.md:**
- Use react-dropzone for drag & drop (NOT custom drag handlers)
- Use zod for file validation schemas
- Validate file type with accept prop + zod schema
- Show clear error messages for rejected files
- Example code in RESEARCH.md shows validation pattern
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create file upload component</name>
  <files>frontend/package.json, frontend/components/audit/file-upload-zone.tsx</files>
  <action>
Install dependencies: `npm install react-dropzone zod --prefix frontend`.

Create FileUploadZone component at `frontend/components/audit/file-upload-zone.tsx`:
- Mark with 'use client'
- Import useDropzone from react-dropzone
- Import z from zod
- Define fileSchema with zod: name must end with .docx, size max 10MB
- Accept props: label (string), onUpload (async function taking File)
- Use useDropzone with accept: {'application/vnd.openxmlformats-officedocument.wordprocessingml.document': ['.docx']}
- Set maxFiles: 1, multiple: false
- Handle onDrop: validate with zod, show errors for rejected files
- Render border-2 border-dashed area with hover/drag states
- Show upload icon when empty
- Show file name + green checkmark when file uploaded
- Show red error message if validation fails
- Style per CONTEXT.md mockup: hover:border-blue-500, error:border-red-500, success:border-green-500

Use react-dropzone (NOT custom drag event handlers) to handle accessibility, keyboard navigation, and edge cases automatically. Use zod for validation (NOT manual regex checks).
  </action>
  <verify>Component renders with dashed border. Dragging .docx file shows hover state. Dropping .docx shows green checkmark + filename. Dropping .pdf shows red error. No console errors.</verify>
  <done>react-dropzone and zod installed. FileUploadZone component created with validation. Accepts .docx only. Shows clear error messages.</done>
</task>

<task type="auto">
  <name>Task 2: Create audit creation page with three upload zones</name>
  <files>frontend/app/(dashboard)/audit/new/page.tsx, frontend/lib/api.ts</files>
  <action>
Create new audit page at `frontend/app/(dashboard)/audit/new/page.tsx` (Client Component):
- Mark with 'use client'
- Import FileUploadZone from @/components/audit/file-upload-zone
- Render three FileUploadZone instances with labels:
  - "Current Year" (required)
  - "Prior Year" (optional)
  - "Internal Memos" (optional)
- Use useState to track uploaded files for each slot
- Show "Start Review" button when at least one file uploaded (disabled otherwise)
- onClick: call createAudit API function, upload files, navigate to /audit/[id]
- Layout: grid of 3 columns on desktop (grid-cols-3), stack on mobile
- Include header: "Audit #001" (or generate ID), status badge "Draft"
- Style per CONTEXT.md mockup: three upload boxes, start button section below

Update `frontend/lib/api.ts`:
- Add createAudit function: POST to /api/audits with FormData
- Add uploadFile function: POST file to /api/documents with multipart/form-data
- Return audit ID from createAudit for navigation
- Use native fetch with FormData (NOT external upload library)

Do NOT build custom multipart/form-data encoder - use browser's native FormData. Do NOT add percentage-based progress bars (out of scope per CONTEXT.md).
  </action>
  <verify>Navigate to /audit/new. Three upload zones render. Drop .docx in "Current Year" - shows success. "Start Review" button enabled. Clicking button creates audit (console log for now, actual API in next plan). No TypeScript errors.</verify>
  <done>Audit creation page renders with three upload zones. Validation works. "Start Review" button appears when file uploaded. API functions defined.</done>
</task>

<task type="auto">
  <name>Task 3: Wire up "New Audit" button and add visual polish</name>
  <files>frontend/components/layout/sidebar.tsx, frontend/app/(dashboard)/audit/new/page.tsx</files>
  <action>
Update Sidebar component:
- Change "New Audit" button href from # to /audit/new
- Ensure it's a Link component from next/link (NOT anchor tag)
- Maintain existing style: primary-light background, hover effects

Polish audit creation page:
- Add "Live Findings Monitor" section below upload zones (empty state for now)
- Show "Monitoring Inactive" message with icon (per mockup)
- Add message: "Real-time analysis and findings will appear here automatically once the review process is initiated"
- Style empty state: centered, gray icon, subtle border
- Add proper spacing between sections
- Ensure responsive layout works on mobile

Verify file upload error states:
- Dropping .pdf shows error: "Only .docx files are allowed"
- Dropping file >10MB shows error: "File must be less than 10MB"
- Multiple files dropped: only first accepted (maxFiles: 1)
- Error messages clear on next successful upload

Do NOT implement actual WebSocket connection yet (that's 07-03). Do NOT show progress bars (indefinite spinners only, per CONTEXT.md).
  </action>
  <verify>Click "New Audit" in sidebar - navigates to /audit/new. Upload zones work with validation. "Live Findings Monitor" shows empty state. Responsive layout works. Error messages clear and specific.</verify>
  <done>"New Audit" button navigates correctly. Upload page polished with empty findings section. All validation edge cases handled. Build succeeds.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build --prefix frontend` succeeds without errors
- [ ] Navigate to /audit/new from sidebar "New Audit" button
- [ ] Three upload zones render with correct labels
- [ ] Dragging .docx file over zone shows hover state
- [ ] Dropping .docx file shows green checkmark + filename
- [ ] Dropping .pdf file shows error: "Only .docx files are allowed"
- [ ] Dropping file >10MB shows error: "File must be less than 10MB"
- [ ] "Start Review" button disabled when no files uploaded
- [ ] "Start Review" button enabled when at least one file uploaded
- [ ] "Live Findings Monitor" shows empty state message
- [ ] Responsive layout works on mobile (stacks vertically)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript or build errors
- File upload works with strict .docx validation
- Visual feedback clear (success/error states)
- Ready for WebSocket integration (07-03)
</success_criteria>

<output>
After completion, create `.planning/phases/07-frontend-dashboard/07-02-SUMMARY.md`:

# Phase 7 Plan 2: File Upload Summary

**File upload functionality with drag & drop validation implemented.**

## Accomplishments

- Installed react-dropzone and zod
- Created FileUploadZone component with strict .docx validation
- Built audit creation page with three upload slots
- Implemented file validation with clear error messages
- Wired "New Audit" button to creation page
- Added "Live Findings Monitor" empty state

## Files Created/Modified

- `frontend/components/audit/file-upload-zone.tsx` - Upload zone with validation
- `frontend/app/(dashboard)/audit/new/page.tsx` - Audit creation page
- `frontend/lib/api.ts` - createAudit, uploadFile functions
- `frontend/components/layout/sidebar.tsx` - Updated "New Audit" link

## Decisions Made

- Used react-dropzone for accessibility and edge case handling
- Used zod for file validation (not manual regex)
- Max file size: 10MB per RESEARCH.md recommendations
- No progress bars (indefinite spinners only, per CONTEXT.md)

## Issues Encountered

None

## Next Step

Ready for 07-03-PLAN.md: WebSocket integration and live agent cards
</output>
