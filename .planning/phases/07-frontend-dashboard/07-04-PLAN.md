---
phase: 07-frontend-dashboard
plan: 04
type: execute
---

<objective>
Implement export functionality and apply final polish to complete the dashboard.

Purpose: Enable users to export audit findings to CSV/PDF formats and ensure professional UI polish meets production quality.
Output: Working export functionality with CSV download and polished UI ready for production use.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-frontend-dashboard/07-CONTEXT.md
@.planning/phases/07-frontend-dashboard/07-RESEARCH.md
@.planning/phases/07-frontend-dashboard/07-03-SUMMARY.md
@frontend/app/(dashboard)/audit/new/page.tsx
@frontend/lib/api.ts

**From CONTEXT.md:**
- Export to CSV and PDF (basic functionality for v1)
- Professional, calm aesthetic throughout
- Responsive design (mobile + desktop)
- No drill-down modals or advanced filtering (v1)
- Keep error handling simple

**From RESEARCH.md:**
- Use json2csv library for CSV export (SOTA: 6.x)
- Use jsPDF + jsPDF-AutoTable for PDF export
- Client-side export (no backend API needed)
- Download via browser download API
- Example code in RESEARCH.md shows export pattern

**From 07-03-SUMMARY.md:**
- WebSocket integration complete
- Agent cards display live findings
- Inline transformation working
- Ready for export and polish
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement CSV and PDF export functionality</name>
  <files>frontend/lib/export.ts, frontend/components/audit/export-button.tsx, frontend/app/(dashboard)/audit/new/page.tsx</files>
  <action>
Install export dependencies: `npm install json2csv jspdf jspdf-autotable --prefix frontend`.

Create export utilities at `frontend/lib/export.ts`:
- Import Parser from json2csv
- Import jsPDF from jspdf
- Import autoTable from jspdf-autotable
- Export exportToCSV function taking findings array:
  - Transform findings to flat structure for CSV
  - Use json2csv Parser with fields: agent, severity, title, description
  - Create Blob with CSV content
  - Trigger download via URL.createObjectURL + anchor click
  - Filename: `audit-findings-${new Date().toISOString()}.csv`
- Export exportToPDF function taking findings array:
  - Create new jsPDF instance
  - Add title: "Audit Findings Report"
  - Add timestamp
  - Use autoTable to render findings table
  - Save with filename: `audit-findings-${new Date().toISOString()}.pdf`

Create ExportButton component at `frontend/components/audit/export-button.tsx`:
- Mark with 'use client'
- Import exportToCSV, exportToPDF from @/lib/export
- Accept props: findings array, disabled boolean
- Render dropdown button with two options: "Export to CSV", "Export to PDF"
- Use Shadcn DropdownMenu component
- onClick handlers call export functions
- Disable when findings.length = 0
- Style: subtle button, icon shows download/file icon

Update audit page to include ExportButton:
- Place ExportButton in top-right corner of "Live Findings Monitor" section
- Pass all findings (not filtered)
- Disable until at least one finding received
- Show subtle "Export" label + icon

Use json2csv and jsPDF (NOT custom CSV string builders or manual PDF layout). Client-side export only (no backend API needed per CONTEXT.md scope).
  </action>
  <verify>Visit /audit/new, upload files, start processing. When findings arrive, "Export" button enabled. Click "Export to CSV" - downloads CSV file with findings. Click "Export to PDF" - downloads PDF with findings table. Files open correctly in Excel/PDF viewer.</verify>
  <done>Export functionality works for CSV and PDF. ExportButton component integrated. Files download with correct format and timestamp. No build errors.</done>
</task>

<task type="auto">
  <name>Task 2: Add responsive design and mobile optimizations</name>
  <files>frontend/app/(dashboard)/layout.tsx, frontend/components/layout/sidebar.tsx, frontend/components/audit/agent-card.tsx, frontend/app/(dashboard)/audit/new/page.tsx</files>
  <action>
Update dashboard layout for mobile:
- Add responsive classes: sidebar hidden on mobile (lg:flex), drawer on small screens
- Main content: full width on mobile, margin-left on desktop
- Add mobile menu toggle button (hamburger icon, top-left)
- Sidebar slides in from left on mobile (transform, transition)
- Close sidebar on mobile when navigation occurs

Update Sidebar component:
- Add mobile drawer behavior with useState for open/closed
- Render as fixed overlay on mobile (z-50, fixed, inset-y-0)
- Desktop: static sidebar (relative, h-screen)
- Backdrop on mobile when open (bg-black/50, click to close)

Update AgentCard for mobile:
- Stack vertically on mobile (grid-cols-1)
- Desktop: 2x2 grid (grid-cols-2)
- Tablet: 2 columns (md:grid-cols-2)
- Ensure findings list readable on small screens
- Touch-friendly spacing (p-4 minimum)

Update audit creation page:
- Upload zones: stack vertically on mobile (grid-cols-1)
- Desktop: 3 columns (lg:grid-cols-3)
- "Start Review" button: full width on mobile, auto on desktop
- Agent cards: 1 column mobile, 2 columns desktop
- Export button: position adjusted for mobile (top of section, not floating)

Test responsive breakpoints:
- Mobile: < 640px (sm)
- Tablet: 640px - 1024px (md/lg)
- Desktop: > 1024px (xl)

Do NOT add mobile-specific features not in desktop version (consistent functionality per CONTEXT.md). Do NOT build custom drawer component (use Shadcn Sheet if needed).
  </action>
  <verify>Resize browser to mobile width (<640px). Sidebar becomes drawer with toggle button. Upload zones stack vertically. Agent cards stack 1 column. All interactions work on touch. No horizontal scroll. Build succeeds.</verify>
  <done>Responsive design implemented. Mobile drawer works. Upload zones and agent cards responsive. Touch-friendly spacing. No layout breaks on any screen size.</done>
</task>

<task type="auto">
  <name>Task 3: Final polish - loading states, error handling, and visual refinements</name>
  <files>frontend/components/audit/agent-card.tsx, frontend/hooks/use-audit-websocket.ts, frontend/app/(dashboard)/audit/new/page.tsx, frontend/components/layout/audit-list.tsx</files>
  <action>
Polish agent cards:
- Add smooth transitions for findings appearing (fade-in animation)
- Ensure severity colors consistent: critical=red-500, warning=amber-500, pass=green-500
- Add empty state message when agent completes with no findings: "No issues detected" + green checkmark icon
- Add subtle border-left-4 with agent color (blue/purple/orange/teal per config)
- Ensure indeterminate spinner animates smoothly (animate-spin)

Improve WebSocket error handling:
- Show connection status indicator: "Connecting...", "Connected", "Disconnected"
- If connection fails, show "Connection failed. Retry?" with reconnect button
- On reconnect: clear previous state, re-establish connection
- If connection closes unexpectedly, attempt auto-reconnect once (after 2s delay)
- Log errors to console for debugging (but simple UI message to user)

Polish audit list:
- Add hover effects on audit items (bg-slate-100 dark:bg-slate-800)
- Highlight current audit (border-l-4 border-primary)
- Show status badge with color: draft=gray, processing=blue, complete=green, error=red
- Add date formatting: "2 hours ago", "Yesterday", "Jan 15" (use relative time)
- Loading skeleton: show 3 placeholder items while fetching

Polish upload zones:
- Add pulse animation on drag-over (border pulses)
- Success state: green border + checkmark icon + filename
- Error state: red border + error icon + message
- Ensure drag-leave doesn't flicker (proper event handling)

Final visual refinements:
- Consistent spacing: p-6 for cards, p-4 for sections, gap-4 for grids
- Typography scale: text-2xl for headings, text-base for body
- Color palette consistency: use theme colors throughout
- Ensure dark mode works for all states (test every component)
- Add subtle shadows: shadow-sm for cards, shadow-md for elevated elements
- Smooth transitions: transition-colors duration-200 for interactive elements

Do NOT add features beyond basic polish (no analytics, no advanced filtering per CONTEXT.md). Do NOT add toast notifications (simple error messages only per CONTEXT.md).
  </action>
  <verify>All components have smooth transitions. Dark mode works perfectly. Error states show clear messages. Loading states visible. Upload drag states work without flicker. Build succeeds with no warnings.</verify>
  <done>Final polish complete. All loading/error states polished. Smooth animations. Dark mode perfected. Visual consistency across all components. Production-ready.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build --prefix frontend` succeeds without errors or warnings
- [ ] Export to CSV works and file opens correctly in Excel
- [ ] Export to PDF works and file renders correctly
- [ ] Mobile responsive design works (test at 375px width)
- [ ] Sidebar drawer works on mobile
- [ ] Upload zones stack correctly on mobile
- [ ] Agent cards responsive on all screen sizes
- [ ] Dark mode works for all components and states
- [ ] Loading states visible and polished
- [ ] Error states show clear messages
- [ ] Smooth transitions on all interactive elements
- [ ] No console errors or warnings
- [ ] WebSocket reconnect works
- [ ] Audit list shows status badges and hover effects
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript or build errors
- Export functionality works (CSV + PDF)
- Responsive design works on mobile, tablet, desktop
- All UI polish complete (loading, error, animations)
- Production-ready quality
- Phase 7 complete
</success_criteria>

<output>
After completion, create `.planning/phases/07-frontend-dashboard/07-04-SUMMARY.md`:

# Phase 7 Plan 4: Export and Polish Summary

**Export functionality and final polish complete. Dashboard ready for production.**

## Accomplishments

- Implemented CSV export with json2csv
- Implemented PDF export with jsPDF + autoTable
- Added responsive design for mobile, tablet, desktop
- Mobile drawer navigation working
- Final polish: loading states, error handling, animations
- Dark mode perfected across all components
- WebSocket auto-reconnect on connection loss

## Files Created/Modified

- `frontend/lib/export.ts` - CSV and PDF export utilities
- `frontend/components/audit/export-button.tsx` - Export dropdown button
- `frontend/app/(dashboard)/layout.tsx` - Responsive layout with mobile drawer
- `frontend/components/layout/sidebar.tsx` - Mobile drawer behavior
- `frontend/components/audit/agent-card.tsx` - Polish and animations
- `frontend/hooks/use-audit-websocket.ts` - Auto-reconnect logic
- `frontend/app/(dashboard)/audit/new/page.tsx` - Responsive upload zones
- `frontend/components/layout/audit-list.tsx` - Status badges and hover effects

## Decisions Made

- Client-side export only (no backend API needed)
- Auto-reconnect once on WebSocket disconnect (2s delay)
- Mobile drawer for sidebar (not bottom navigation)
- Simple error messages (no toast notifications)
- Relative time formatting for audit list dates

## Issues Encountered

None

## Phase 7 Complete

Frontend dashboard fully implemented:
- ✅ Dark mode with theme toggle
- ✅ Dashboard layout with sidebar navigation
- ✅ Audit CRUD operations
- ✅ File upload with strict validation
- ✅ Real-time WebSocket integration
- ✅ Live agent cards with findings display
- ✅ Export to CSV and PDF
- ✅ Responsive design (mobile/tablet/desktop)
- ✅ Production-ready polish

**Ready for Phase 8 or production deployment.**
</output>
