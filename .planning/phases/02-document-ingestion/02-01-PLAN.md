---
type: plan
phase: 02-document-ingestion
plan: 02-01
domain: document-ingestion
---

# Plan 02-01: Upload API & Storage

Implement the document upload endpoint that saves `.docx` files to storage (GCS/local) and tracks them in the database.

## Objective
Enable users to upload financial statement documents which are stored and tracked via `Job` and `Document` models.

## Execution Context
- **Tech available**: FastAPI, SQLAlchemy 2.0, `python-docx` (to be installed), `google-cloud-storage`.
- **Patterns**: FastAPI dependencies for DB and Storage service.
- **Decisions**: Use `uploads/` for local storage in development.

## Tasks

<task name="setup_dependencies" type="auto">
Add `python-docx` to `backend/requirements.txt` and install it.
<files>
- backend/requirements.txt
</files>
<action>
Add `python-docx==1.1.0` to requirements.
</action>
<verify>
`pip list | grep python-docx`
</verify>
</task>

<task name="create_document_schemas" type="auto">
Create Pydantic schemas for document and job responses.
<files>
- backend/app/schemas/document.py
- backend/app/schemas/job.py
</files>
<action>
Define `DocumentRead`, `JobRead` schemas.
</action>
<verify>
Schemas exist and can be imported.
</verify>
</task>

<task name="implement_upload_route" type="auto">
Create the document upload endpoint.
<files>
- backend/app/api/routes/documents.py
</files>
<action>
1. Define `POST /upload` endpoint.
2. Accept `file: UploadFile`.
3. Create a new `Job`.
4. Upload file using `StorageService`.
5. Create `Document` record linked to the `Job`.
6. Return the `Job` details.
</action>
<verify>
Endpoint exists and returns 200 with Job ID.
</verify>
</task>

<task name="register_router" type="auto">
Register the documents router in the main FastAPI app.
<files>
- backend/app/main.py
- backend/app/api/routes/__init__.py
</files>
<action>
Expose documents router in `backend/app/api/routes/__init__.py` and include it in `main.py` under prefix `/api/v1/documents`.
</action>
<verify>
`docs/` shows the new endpoint.
</verify>
</task>

## Success Criteria
- [ ] Document upload endpoint is functional.
- [ ] Files are saved to `uploads/` (local) or GCS.
- [ ] `Job` and `Document` records are created in the database.
- [ ] API returns a valid Job UUID.
